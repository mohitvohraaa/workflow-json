{"id":"f310ccb0-4a0f-43cf-bc69-bb12892941ce","revision":0,"last_node_id":160,"last_link_id":202,"nodes":[{"id":2,"type":"GetNode","pos":[5054.68994140625,1479.7242431640625],"size":[210,58],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"label":"MASK","name":"MASK","type":"MASK","links":[14]}],"properties":{"widget_ue_connectable":{}},"widgets_values":["mask"],"color":"#1c5715","bgcolor":"#1f401b"},{"id":96,"type":"Note","pos":[1105.223876953125,362.8482360839844],"size":[210,88],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["If you get an \"out of memory\" error while running the workflow, you can try enabling and using this node. It can help reduce the load on your VRAM to some extent."],"color":"#432","bgcolor":"#653"},{"id":15,"type":"WanVideoBlockSwap","pos":[1097.1124267578125,105.98529052734375],"size":[281.404296875,202],"flags":{},"order":2,"mode":4,"inputs":[],"outputs":[{"label":"block_swap_args","name":"block_swap_args","type":"BLOCKSWAPARGS","links":[17]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoBlockSwap"},"widgets_values":[40,false,false,true,0,1,false]},{"id":99,"type":"Note","pos":[2734.575439453125,76.73501586914062],"size":[215.18026733398438,88],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["The longest side of the video"],"color":"#432","bgcolor":"#653"},{"id":103,"type":"SetNode","pos":[1918.3133544921875,977.04248046875],"size":[210,60],"flags":{},"order":49,"mode":0,"inputs":[{"name":"INT","type":"INT","link":120}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Resize Width","properties":{"previousName":"Resize Width"},"widgets_values":["Resize Width"],"color":"#1b4669","bgcolor":"#29699c"},{"id":104,"type":"SetNode","pos":[1923.3134765625,1096.6224365234375],"size":[210,58],"flags":{},"order":50,"mode":0,"inputs":[{"name":"INT","type":"INT","link":121}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Resize Height","properties":{"previousName":"Resize Height"},"widgets_values":["Resize Height"],"color":"#1b4669","bgcolor":"#29699c"},{"id":101,"type":"GetNode","pos":[1607.491455078125,1220.6171875],"size":[210,60],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[{"name":"INT","type":"INT","links":[118]}],"title":"Get_Height","properties":{},"widgets_values":["Height"],"color":"#1b4669","bgcolor":"#29699c"},{"id":97,"type":"Note","pos":[2978.705078125,1472.2728271484375],"size":[368.03857421875,119.98920440673828],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["1. We recommend using a reference image with a clean background.\n2. Ref2 is optional. You can use a face image as ref2 to enhance face fiedlity.\n3. The model will achieve the best results when the pose of the character in the reference image is close to the pose of the character in the first frame of the video."],"color":"#432","bgcolor":"#653"},{"id":105,"type":"GetNode","pos":[3378.34130859375,1263.0496826171875],"size":[210,60],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[{"name":"INT","type":"INT","links":[122]}],"title":"Get_Resize Width","properties":{},"widgets_values":["Resize Width"],"color":"#1b4669","bgcolor":"#29699c"},{"id":100,"type":"SetNode","pos":[3232.518310546875,79.64688110351562],"size":[210,60],"flags":{},"order":39,"mode":0,"inputs":[{"name":"INT","type":"INT","link":117}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Height","properties":{"previousName":"Height"},"widgets_values":["Height"],"color":"#1b4669","bgcolor":"#29699c"},{"id":109,"type":"GetNode","pos":[5038.09912109375,997.2615356445312],"size":[210,60],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[{"name":"STRING","type":"STRING","links":[129]}],"title":"Get_Prompts","properties":{},"widgets_values":["Prompts"]},{"id":111,"type":"GetNode","pos":[5043.234375,1139.9681396484375],"size":[210,60],"flags":{},"order":8,"mode":0,"inputs":[],"outputs":[{"name":"WANVIDEOMODEL","type":"WANVIDEOMODEL","links":[130]}],"title":"Get_Model","properties":{},"widgets_values":["Model"]},{"id":116,"type":"SetNode","pos":[1608.8756103515625,1351.069580078125],"size":[210,60],"flags":{},"order":36,"mode":0,"inputs":[{"name":"AUDIO","type":"AUDIO","link":134}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Audio","properties":{"previousName":"Audio"},"widgets_values":["Audio"]},{"id":43,"type":"VHS_LoadVideo","pos":[1098.910400390625,811.1181030273438],"size":[401.65234375,334],"flags":{},"order":9,"mode":0,"inputs":[{"label":"ÊâπÊ¨°ÁÆ°ÁêÜ","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"label":"vae","name":"vae","shape":7,"type":"VAE","link":null}],"outputs":[{"label":"ÂõæÂÉè","name":"IMAGE","type":"IMAGE","links":[23]},{"label":"Â∏ßËÆ°Êï∞","name":"frame_count","type":"INT","links":[]},{"label":"Èü≥È¢ë","name":"audio","type":"AUDIO","links":[134]},{"label":"ËßÜÈ¢ë‰ø°ÊÅØ","name":"video_info","type":"VHS_VIDEOINFO","links":[52]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"VHS_LoadVideo","cnr_id":"comfyui-videohelpersuite","ver":"0a75c7958fe320efcb052f1d9f8451fd20c730a8"},"widgets_values":{"video":"b9387822ff334cb4c0cf6b8f0248b9a92a72e444a3a184955c08afe6b2bc025d.mp4","force_rate":0,"force_size":"Disabled","custom_width":0,"custom_height":0,"frame_load_cap":0,"skip_first_frames":0,"select_every_nth":1,"format":"AnimateDiff","choose video to upload":"image","videopreview":{"paused":false,"hidden":false,"params":{"custom_height":0,"filename":"b9387822ff334cb4c0cf6b8f0248b9a92a72e444a3a184955c08afe6b2bc025d.mp4","force_rate":0,"custom_width":0,"select_every_nth":1,"frame_load_cap":0,"format":"video/mp4","skip_first_frames":0,"type":"input"}}}},{"id":14,"type":"WanVideoVAELoader","pos":[5715.2021484375,1779.665283203125],"size":[397.5917663574219,92.40150451660156],"flags":{},"order":10,"mode":0,"inputs":[{"label":"compile_args","name":"compile_args","shape":7,"type":"WANCOMPILEARGS","link":null}],"outputs":[{"label":"vae","name":"vae","type":"WANVAE","links":[12,49]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoVAELoader"},"widgets_values":["Wan2_1_VAE_bf16.safetensors","bf16"]},{"id":46,"type":"WanVideoLoraSelectMulti","pos":[1409.8905029296875,99.30438232421875],"size":[330.9622497558594,342],"flags":{},"order":11,"mode":0,"inputs":[{"label":"prev_lora","name":"prev_lora","shape":7,"type":"WANVIDLORA","link":null},{"label":"blocks","name":"blocks","shape":7,"type":"SELECTEDBLOCKS","link":null}],"outputs":[{"label":"lora","name":"lora","type":"WANVIDLORA","links":[18]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoLoraSelectMulti"},"widgets_values":["lightx2v_T2V_14B_cfg_step_distill_v2_lora_rank128_bf16.safetensors",1,"none",1,"none",1,"none",1,"none",1,false,false]},{"id":16,"type":"WanVideoModelLoader","pos":[1814.1722412109375,80.16863250732422],"size":[523.8882446289062,331.25714111328125],"flags":{},"order":38,"mode":0,"inputs":[{"label":"compile_args","name":"compile_args","shape":7,"type":"WANCOMPILEARGS","link":null},{"label":"block_swap_args","name":"block_swap_args","shape":7,"type":"BLOCKSWAPARGS","link":17},{"label":"lora","name":"lora","shape":7,"type":"WANVIDLORA","link":18},{"label":"vram_management_args","name":"vram_management_args","shape":7,"type":"VRAM_MANAGEMENTARGS","link":null},{"label":"extra_model","name":"extra_model","shape":7,"type":"VACEPATH","link":null},{"label":"fantasytalking_model","name":"fantasytalking_model","shape":7,"type":"FANTASYTALKINGMODEL","link":null},{"label":"multitalk_model","name":"multitalk_model","shape":7,"type":"MULTITALKMODEL","link":null},{"label":"fantasyportrait_model","name":"fantasyportrait_model","shape":7,"type":"FANTASYPORTRAITMODEL","link":null}],"outputs":[{"label":"model","name":"model","type":"WANVIDEOMODEL","links":[55]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoModelLoader"},"widgets_values":["MoCha/Wan2_1_mocha-14B-preview_fp8_e4m3fn_scaled_KJ.safetensors","fp16_fast","disabled","offload_device","sageattn","default"]},{"id":48,"type":"SetNode","pos":[2114.051513671875,474.9378662109375],"size":[210,60],"flags":{},"order":52,"mode":0,"inputs":[{"name":"WANVIDEOMODEL","type":"WANVIDEOMODEL","link":55}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Model","properties":{"previousName":"Model"},"widgets_values":["Model"]},{"id":45,"type":"GetImageRangeFromBatch","pos":[1921.4508056640625,814.5028686523438],"size":[210,102],"flags":{},"order":47,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"images","shape":7,"type":"IMAGE","link":53},{"label":"ÈÅÆÁΩ©","name":"masks","shape":7,"type":"MASK","link":null}],"outputs":[{"label":"ÂõæÂÉè","name":"IMAGE","type":"IMAGE","links":[119]},{"label":"ÈÅÆÁΩ©","name":"MASK","type":"MASK"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"GetImageRangeFromBatch"},"widgets_values":[0,1]},{"id":102,"type":"SetNode","pos":[1922.8741455078125,1348.2222900390625],"size":[210,60],"flags":{},"order":58,"mode":0,"inputs":[{"name":"IMAGE","type":"IMAGE","link":119}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_First Frame","properties":{"previousName":"First Frame"},"widgets_values":["First Frame"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":22,"type":"LayerUtility: ImageScaleByAspectRatio V2","pos":[1604.525146484375,809.0441284179688],"size":[277.5946044921875,330],"flags":{},"order":35,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"image","shape":7,"type":"IMAGE","link":23},{"label":"ÈÅÆÁΩ©","name":"mask","shape":7,"type":"MASK","link":null},{"label":"scale_to_length","name":"scale_to_length","type":"INT","widget":{"name":"scale_to_length"},"link":118}],"outputs":[{"label":"ÂõæÂÉè","name":"image","type":"IMAGE","links":[19,53,143]},{"label":"ÈÅÆÁΩ©","name":"mask","type":"MASK"},{"label":"ÂéüÂßãÂ§ßÂ∞è","name":"original_size","type":"BOX"},{"label":"width","name":"width","type":"INT","links":[120]},{"label":"height","name":"height","type":"INT","links":[121]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"LayerUtility: ImageScaleByAspectRatio V2"},"widgets_values":["original",1,1,"letterbox","lanczos","16","longest",832,"#000000"]},{"id":113,"type":"SetNode","pos":[1917.99365234375,1705.5966796875],"size":[210,58],"flags":{},"order":51,"mode":0,"inputs":[{"name":"FLOAT","type":"FLOAT","link":132}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_FPS","properties":{"previousName":"FPS"},"widgets_values":["FPS"],"color":"#232","bgcolor":"#353"},{"id":120,"type":"easy imageSize","pos":[1917.005615234375,1470.8828125],"size":[210,153.6037139892578],"flags":{},"order":48,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"image","type":"IMAGE","link":143}],"outputs":[{"label":"ÂÆΩÂ∫¶","name":"width_int","type":"INT","links":null},{"label":"È´òÂ∫¶","name":"height_int","type":"INT","links":null}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"easy imageSize"},"widgets_values":["Width: 480 , Height: 832"]},{"id":44,"type":"VHS_VideoInfo","pos":[1611.6695556640625,1563.7376708984375],"size":[225.59765625,206],"flags":{},"order":37,"mode":0,"inputs":[{"label":"ËßÜÈ¢ë‰ø°ÊÅØ","name":"video_info","type":"VHS_VIDEOINFO","link":52}],"outputs":[{"label":"ÂàùÂßãFPSüü®","name":"source_fpsüü®","type":"FLOAT"},{"label":"ÂàùÂßãÂ∏ßÊï∞üü®","name":"source_frame_countüü®","type":"INT"},{"label":"ÂàùÂßãÊó∂Èïøüü®","name":"source_durationüü®","type":"FLOAT"},{"label":"ÂàùÂßãÂÆΩÂ∫¶üü®","name":"source_widthüü®","type":"INT"},{"label":"ÂàùÂßãÈ´òÂ∫¶üü®","name":"source_heightüü®","type":"INT"},{"label":"ÈÄâ‰∏≠FPSüü¶","name":"loaded_fpsüü¶","type":"FLOAT","links":[132]},{"label":"ÈÄâ‰∏≠Â∏ßÊï∞üü¶","name":"loaded_frame_countüü¶","type":"INT"},{"label":"ÈÄâ‰∏≠Êó∂Èïøüü¶","name":"loaded_durationüü¶","type":"FLOAT"},{"label":"ÈÄâ‰∏≠ÂÆΩÂ∫¶üü¶","name":"loaded_widthüü¶","type":"INT"},{"label":"ÈÄâ‰∏≠È´òÂ∫¶üü¶","name":"loaded_heightüü¶","type":"INT"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"VHS_VideoInfo"},"widgets_values":{}},{"id":128,"type":"PlaySound|pysssss","pos":[5650.8671875,1696.4322509765625],"size":[270,106],"flags":{"collapsed":true},"order":65,"mode":0,"inputs":[{"label":"ËæìÂÖ•","name":"any","type":"*","link":150}],"outputs":[{"name":"*","shape":6,"type":"*","links":null}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"PlaySound|pysssss"},"widgets_values":["always",0.5,"notify.mp3"]},{"id":10,"type":"WanVideoSampler","pos":[5795.8994140625,972.2015380859375],"size":[327.80859375,734],"flags":{},"order":56,"mode":0,"inputs":[{"label":"model","name":"model","type":"WANVIDEOMODEL","link":130},{"label":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","link":10},{"label":"text_embeds","name":"text_embeds","shape":7,"type":"WANVIDEOTEXTEMBEDS","link":11},{"label":"samples","name":"samples","shape":7,"type":"LATENT","link":null},{"label":"feta_args","name":"feta_args","shape":7,"type":"FETAARGS","link":null},{"label":"context_options","name":"context_options","shape":7,"type":"WANVIDCONTEXT","link":null},{"label":"cache_args","name":"cache_args","shape":7,"type":"CACHEARGS","link":null},{"label":"flowedit_args","name":"flowedit_args","shape":7,"type":"FLOWEDITARGS","link":null},{"label":"slg_args","name":"slg_args","shape":7,"type":"SLGARGS","link":null},{"label":"loop_args","name":"loop_args","shape":7,"type":"LOOPARGS","link":null},{"label":"experimental_args","name":"experimental_args","shape":7,"type":"EXPERIMENTALARGS","link":null},{"label":"sigmas","name":"sigmas","shape":7,"type":"SIGMAS","link":null},{"label":"unianimate_poses","name":"unianimate_poses","shape":7,"type":"UNIANIMATE_POSE","link":null},{"label":"fantasytalking_embeds","name":"fantasytalking_embeds","shape":7,"type":"FANTASYTALKING_EMBEDS","link":null},{"label":"uni3c_embeds","name":"uni3c_embeds","shape":7,"type":"UNI3C_EMBEDS","link":null},{"label":"multitalk_embeds","name":"multitalk_embeds","shape":7,"type":"MULTITALK_EMBEDS","link":null},{"label":"freeinit_args","name":"freeinit_args","shape":7,"type":"FREEINITARGS","link":null},{"label":"character_render_latent","name":"character_render_latent","shape":7,"type":"LATENT","link":null}],"outputs":[{"label":"samples","name":"samples","type":"LATENT","links":[50]},{"label":"denoised_samples","name":"denoised_samples","type":"LATENT"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoSampler"},"widgets_values":[6,1.0000000000000002,8.000000000000002,1087275199527341,"randomize",true,"euler",0,1,false,"comfy",0,-1,false]},{"id":47,"type":"WanVideoTextEncodeCached","pos":[5308.30859375,983.1329956054688],"size":[400,302],"flags":{},"order":34,"mode":0,"inputs":[{"label":"extender_args","name":"extender_args","shape":7,"type":"WANVIDEOPROMPTEXTENDER_ARGS","link":null},{"label":"positive_prompt","name":"positive_prompt","type":"STRING","widget":{"name":"positive_prompt"},"link":129}],"outputs":[{"label":"text_embeds","name":"text_embeds","type":"WANVIDEOTEXTEMBEDS","links":[11]},{"label":"negative_text_embeds","name":"negative_text_embeds","type":"WANVIDEOTEXTEMBEDS"},{"label":"positive_prompt","name":"positive_prompt","type":"STRING"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoTextEncodeCached"},"widgets_values":["umt5-xxl-enc-bf16.safetensors","bf16","","","disabled",true,"gpu"]},{"id":98,"type":"easy int","pos":[2992.518310546875,79.64688110351562],"size":[210,58],"flags":{},"order":12,"mode":0,"inputs":[],"outputs":[{"label":"Êï¥Êï∞","name":"int","type":"INT","links":[117]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"easy int"},"widgets_values":[832],"color":"#323","bgcolor":"#535"},{"id":108,"type":"SetNode","pos":[3361.769287109375,241.55731201171875],"size":[210,60],"flags":{},"order":43,"mode":0,"inputs":[{"name":"STRING","type":"STRING","link":128}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_Prompts","properties":{"previousName":"Prompts"},"widgets_values":["Prompts"]},{"id":138,"type":"RMBG","pos":[3684.986328125,867.7647705078125],"size":[340,302],"flags":{},"order":55,"mode":0,"inputs":[{"label":"image","name":"image","type":"IMAGE","link":164}],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[165]},{"label":"MASK","name":"MASK","type":"MASK"},{"label":"MASK_IMAGE","name":"MASK_IMAGE","type":"IMAGE"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"RMBG"},"widgets_values":["RMBG-2.0",1,1024,0,0,false,false,"Color","#ffffff"],"color":"#222e40","bgcolor":"#364254"},{"id":107,"type":"PreviewImage","pos":[4072.18115234375,867.9219970703125],"size":[379.30108642578125,577.8395385742188],"flags":{},"order":61,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"images","type":"IMAGE","link":165}],"outputs":[],"properties":{"widget_ue_connectable":{},"Node name for S&R":"PreviewImage"},"widgets_values":[]},{"id":106,"type":"GetNode","pos":[3632.56396484375,1262.7742919921875],"size":[210,58],"flags":{},"order":13,"mode":0,"inputs":[],"outputs":[{"name":"INT","type":"INT","links":[123]}],"title":"Get_Resize Height","properties":{},"widgets_values":["Resize Height"],"color":"#1b4669","bgcolor":"#29699c"},{"id":20,"type":"SetNode","pos":[3376.1279296875,1471.8719482421875],"size":[210,58],"flags":{},"order":54,"mode":0,"inputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","link":21}],"outputs":[{"label":"ËæìÂá∫","name":"*","type":"*"}],"title":"Set_Ref1","properties":{"previousName":"Ref1","widget_ue_connectable":{}},"widgets_values":["Ref1"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":17,"type":"SetNode","pos":[1923.0548095703125,1220.9449462890625],"size":[210,58],"flags":{},"order":46,"mode":0,"inputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","link":19}],"outputs":[{"label":"ËæìÂá∫","name":"*","type":"*"}],"title":"Set_Resize video","properties":{"previousName":"Resize video","widget_ue_connectable":{}},"widgets_values":["Resize video"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":8,"type":"GetNode","pos":[5053.5439453125,1356.62109375],"size":[210,58],"flags":{},"order":14,"mode":0,"inputs":[],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[13]}],"title":"Get_Resize video","properties":{"widget_ue_connectable":{}},"widgets_values":["Resize video"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":23,"type":"ImageResizeKJv2","pos":[3362.00146484375,855.5831298828125],"size":[270,336.0001220703125],"flags":{},"order":42,"mode":0,"inputs":[{"label":"image","name":"image","type":"IMAGE","link":24},{"label":"mask","name":"mask","shape":7,"type":"MASK","link":null},{"label":"width","name":"width","type":"INT","widget":{"name":"width"},"link":122},{"label":"height","name":"height","type":"INT","widget":{"name":"height"},"link":123}],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[21,164]},{"label":"width","name":"width","type":"INT","links":[]},{"label":"height","name":"height","type":"INT","links":[]},{"label":"mask","name":"mask","type":"MASK"}],"properties":{"widget_ue_connectable":{"width":true,"height":true},"Node name for S&R":"ImageResizeKJv2"},"widgets_values":[832,480,"bicubic","crop","0,0,0","center",16,"cpu","<tr><td>Output: </td><td><b>1</b> x <b>480</b> x <b>832 | 4.57MB</b></td></tr>7a1fda3c620fb2d5b8bc4acb9d23966d"]},{"id":7,"type":"GrowMask","pos":[1714.323486328125,2743.35498046875],"size":[238.97250366210938,82.43704223632812],"flags":{"collapsed":false},"order":53,"mode":0,"inputs":[{"label":"ÈÅÆÁΩ©","name":"mask","type":"MASK","link":153}],"outputs":[{"label":"ÈÅÆÁΩ©","name":"MASK","type":"MASK","links":[162,163]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"GrowMask","cnr_id":"comfy-core","ver":"0.3.59"},"widgets_values":[10,true]},{"id":6,"type":"SetNode","pos":[1734.93798828125,2948.532470703125],"size":[210,58],"flags":{},"order":60,"mode":0,"inputs":[{"label":"MASK","name":"MASK","type":"MASK","link":163}],"outputs":[{"label":"ËæìÂá∫","name":"*","type":"*"}],"properties":{"previousName":"","widget_ue_connectable":{}},"widgets_values":["mask"],"color":"#1c5715","bgcolor":"#1f401b"},{"id":141,"type":"Note","pos":[3022.25244140625,2826.67041015625],"size":[368.03857421875,119.98920440673828],"flags":{},"order":15,"mode":4,"inputs":[],"outputs":[],"properties":{},"widgets_values":["1. We recommend using a reference image with a clean background.\n2. Ref2 is optional. You can use a face image as ref2 to enhance face fiedlity.\n3. The model will achieve the best results when the pose of the character in the reference image is close to the pose of the character in the first frame of the video."],"color":"#432","bgcolor":"#653"},{"id":11,"type":"MochaEmbeds","pos":[5321.65234375,1356.20703125],"size":[270,234],"flags":{},"order":44,"mode":0,"inputs":[{"label":"vae","name":"vae","type":"WANVAE","link":12},{"label":"input_video","name":"input_video","type":"IMAGE","link":13},{"label":"mask","name":"mask","type":"MASK","link":14},{"label":"ref1","name":"ref1","type":"IMAGE","link":194},{"label":"ref2","name":"ref2","shape":7,"type":"IMAGE","link":null}],"outputs":[{"label":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","links":[10]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"MochaEmbeds"},"widgets_values":[832,false]},{"id":140,"type":"LayerMask: SegformerB2ClothesUltra","pos":[1092.328857421875,2205.358642578125],"size":[270,630],"flags":{},"order":41,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"image","type":"IMAGE","link":168}],"outputs":[{"label":"ÂõæÂÉè","name":"image","type":"IMAGE","links":null},{"label":"ÈÅÆÁΩ©","name":"mask","type":"MASK","links":null}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"LayerMask: SegformerB2ClothesUltra"},"widgets_values":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,"VITMatte",12,6,0.15,0.99,true,"cuda",2],"color":"rgba(27, 80, 119, 0.7)"},{"id":144,"type":"PreviewImage","pos":[4124.2724609375,2223.216064453125],"size":[379.30108642578125,577.8395385742188],"flags":{},"order":67,"mode":4,"inputs":[{"label":"ÂõæÂÉè","name":"images","type":"IMAGE","link":186}],"outputs":[],"properties":{"widget_ue_connectable":{},"Node name for S&R":"PreviewImage"},"widgets_values":[]},{"id":150,"type":"Crop Face","pos":[3387.777099609375,2211.425537109375],"size":[270,122],"flags":{},"order":45,"mode":4,"inputs":[{"label":"model","name":"model","type":"RETINAFACE","link":182},{"label":"image","name":"image","type":"IMAGE","link":195}],"outputs":[{"label":"face_image","name":"face_image","type":"IMAGE","links":[184]},{"label":"preview","name":"preview","type":"IMAGE","links":null},{"label":"bbox","name":"bbox","type":"BBOX","links":null}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"Crop Face"},"widgets_values":[0.8,32]},{"id":151,"type":"Load RetinaFace","pos":[3388.530517578125,2397.529052734375],"size":[146.52694702148438,26],"flags":{},"order":16,"mode":4,"inputs":[],"outputs":[{"label":"MODEL","name":"MODEL","type":"RETINAFACE","links":[182]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"Load RetinaFace"}},{"id":143,"type":"RMBG","pos":[3382.615966796875,2481.9169921875],"size":[340,302],"flags":{},"order":57,"mode":4,"inputs":[{"label":"image","name":"image","type":"IMAGE","link":184}],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[185]},{"label":"MASK","name":"MASK","type":"MASK"},{"label":"MASK_IMAGE","name":"MASK_IMAGE","type":"IMAGE"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"RMBG"},"widgets_values":["RMBG-2.0",1,1024,0,0,false,false,"Color","#ffffff"],"color":"#222e40","bgcolor":"#364254"},{"id":142,"type":"GetNode","pos":[3776.7607421875,2622.612060546875],"size":[210,58],"flags":{},"order":17,"mode":4,"inputs":[],"outputs":[{"name":"INT","type":"INT","links":[173]}],"title":"Get_Resize Width","properties":{},"widgets_values":["Resize Width"],"color":"#1b4669","bgcolor":"#29699c"},{"id":145,"type":"GetNode","pos":[3778.9912109375,2757.70556640625],"size":[210,58],"flags":{},"order":18,"mode":4,"inputs":[],"outputs":[{"name":"INT","type":"INT","links":[174]}],"title":"Get_Resize Height","properties":{},"widgets_values":["Resize Height"],"color":"#1b4669","bgcolor":"#29699c"},{"id":146,"type":"SetNode","pos":[3781.210693359375,2887.16943359375],"size":[210,58],"flags":{},"order":68,"mode":4,"inputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","link":187}],"outputs":[{"label":"ËæìÂá∫","name":"*","type":"*"}],"title":"Set_Ref2","properties":{"previousName":"Ref2","widget_ue_connectable":{}},"widgets_values":["Ref2"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":114,"type":"GetNode","pos":[6494.234375,845.1492919921875],"size":[210,60],"flags":{},"order":19,"mode":0,"inputs":[],"outputs":[{"name":"FLOAT","type":"FLOAT","links":[133,188]}],"title":"Get_FPS","properties":{},"widgets_values":["FPS"],"color":"#232","bgcolor":"#353"},{"id":117,"type":"GetNode","pos":[6237.3291015625,848.0613403320312],"size":[210,60],"flags":{},"order":20,"mode":0,"inputs":[],"outputs":[{"name":"AUDIO","type":"AUDIO","links":[135,189]}],"title":"Get_Audio","properties":{},"widgets_values":["Audio"]},{"id":42,"type":"WanVideoDecode","pos":[5337.45751953125,1674.128173828125],"size":[270,198],"flags":{},"order":62,"mode":0,"inputs":[{"label":"vae","name":"vae","type":"WANVAE","link":49},{"label":"samples","name":"samples","type":"LATENT","link":50}],"outputs":[{"label":"images","name":"images","type":"IMAGE","links":[46,150,190]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"WanVideoDecode"},"widgets_values":[false,272,272,144,128,"default"]},{"id":152,"type":"Note","pos":[1384.2281494140625,2255.91064453125],"size":[274.77325439453125,88],"flags":{},"order":21,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Select the mask area as needed. For a full character swap, select the entire body. For a face swap, select the face and hair area."],"color":"#432","bgcolor":"#653"},{"id":147,"type":"ImageResizeKJv2","pos":[3755.87451171875,2213.270263671875],"size":[270,336.0001220703125],"flags":{},"order":63,"mode":4,"inputs":[{"label":"image","name":"image","type":"IMAGE","link":185},{"label":"mask","name":"mask","shape":7,"type":"MASK","link":null},{"label":"width","name":"width","type":"INT","widget":{"name":"width"},"link":173},{"label":"height","name":"height","type":"INT","widget":{"name":"height"},"link":174}],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[186,187]},{"label":"width","name":"width","type":"INT","links":[]},{"label":"height","name":"height","type":"INT","links":[]},{"label":"mask","name":"mask","type":"MASK"}],"properties":{"widget_ue_connectable":{"width":true,"height":true},"Node name for S&R":"ImageResizeKJv2"},"widgets_values":[832,480,"bicubic","pad","255,255,255","center",16,"cpu","<tr><td>Output: </td><td><b>1</b> x <b>480</b> x <b>832 | 4.57MB</b></td></tr>7a1fda3c620fb2d5b8bc4acb9d23966d"]},{"id":3,"type":"MaskPreview","pos":[2030.79296875,2216.30078125],"size":[413.74114990234375,596.8089599609375],"flags":{},"order":59,"mode":0,"inputs":[{"label":"mask","name":"mask","type":"MASK","link":162}],"outputs":[],"properties":{"widget_ue_connectable":{},"Node name for S&R":"MaskPreview"},"widgets_values":[]},{"id":112,"type":"GetNode","pos":[1113.1591796875,2927.882568359375],"size":[210,60],"flags":{},"order":22,"mode":0,"inputs":[],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[152,168]}],"title":"Get_First Frame","properties":{},"widgets_values":["First Frame"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":156,"type":"Note","pos":[2753.4033203125,920.8287353515625],"size":[210,95.57240295410156],"flags":{},"order":23,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Use this group when you're swapping the character."],"color":"#432","bgcolor":"#653"},{"id":13,"type":"LoadImage","pos":[2979.255859375,854.1470947265625],"size":[329.1049499511719,562.2514038085938],"flags":{},"order":24,"mode":0,"inputs":[],"outputs":[{"label":"ÂõæÂÉè","name":"IMAGE","type":"IMAGE","links":[24]},{"label":"ÈÅÆÁΩ©","name":"MASK","type":"MASK"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"LoadImage"},"widgets_values":["0102fa7ea87be425511be35a74633dd7ecfdfee7e563a63791ec010f5f546ad1.jpeg","image"]},{"id":12,"type":"MarkdownNote","pos":[595.9693603515625,56.10417556762695],"size":[373.58203125,202.54652404785156],"flags":{"collapsed":false},"order":25,"mode":0,"inputs":[],"outputs":[],"properties":{"widget_ue_connectable":{}},"widgets_values":["## Github\nhttps://github.com/Orange-3DV-Team/MoCha\n\n\n## Models on Huggingface\n\nhttps://huggingface.co/Orange-3DV-Team/MoCha\n\nhttps://huggingface.co/Kijai/WanVideo_comfy"],"color":"#432","bgcolor":"#653"},{"id":157,"type":"Note","pos":[2738.614013671875,238.92791748046875],"size":[215.18026733398438,88],"flags":{},"order":26,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":[""],"color":"#432","bgcolor":"#653"},{"id":153,"type":"TT_img_enc","pos":[5319.78955078125,1976.7135009765625],"size":[400,200],"flags":{},"order":66,"mode":0,"inputs":[{"label":"images","name":"images","type":"IMAGE","link":190},{"label":"audio","name":"audio","shape":7,"type":"AUDIO","link":189},{"label":"fps","name":"fps","type":"FLOAT","widget":{"name":"fps"},"link":188}],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[191]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"TT_img_enc"},"widgets_values":[16,6,""]},{"id":154,"type":"SaveImage","pos":[5835.310546875,1978.6595458984375],"size":[270,270],"flags":{},"order":69,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"images","type":"IMAGE","link":191}],"outputs":[],"properties":{"widget_ue_connectable":{},"Node name for S&R":"SaveImage"},"widgets_values":["ComfyUI"]},{"id":41,"type":"VHS_VideoCombine","pos":[6227.74365234375,970.20947265625],"size":[731.2791137695312,358],"flags":{},"order":64,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"images","type":"IMAGE","link":46},{"label":"Èü≥È¢ë","name":"audio","shape":7,"type":"AUDIO","link":135},{"label":"ÊâπÊ¨°ÁÆ°ÁêÜ","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"label":"vae","name":"vae","shape":7,"type":"VAE","link":null},{"label":"frame_rate","name":"frame_rate","type":"FLOAT","widget":{"name":"frame_rate"},"link":133}],"outputs":[{"label":"Êñá‰ª∂Âêç","name":"Filenames","type":"VHS_FILENAMES"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"VHS_VideoCombine"},"widgets_values":{"frame_rate":24,"loop_count":0,"filename_prefix":"AnimateDiff","format":"video/h264-mp4","pix_fmt":"yuv420p","crf":19,"save_metadata":true,"trim_to_audio":false,"pingpong":false,"save_output":true,"no_preview":false,"videopreview":{"paused":false,"hidden":false,"params":{"score":"0","filename":"AnimateDiff_00002_p81-audio_nobsy_1761216939.mp4","workflow":"AnimateDiff_00002_p81.png","fullpath":"/data/ComfyUI/personal/68fb2d66c3ec5d1e91ecffba66a80fd1/output/AnimateDiff_00002_p81-audio.mp4","format":"video/h264-mp4","subfolder":"","label":"Normal","type":"output","frame_rate":30}}}},{"id":29,"type":"CR Prompt Text","pos":[2990.998779296875,237.13153076171875],"size":[321.3017883300781,175.68667602539062],"flags":{},"order":27,"mode":0,"inputs":[],"outputs":[{"label":"ÊèêÁ§∫ËØçÊñáÊú¨","name":"prompt","type":"STRING","links":[128]},{"label":"show_help","name":"show_help","type":"STRING"}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"CR Prompt Text"},"widgets_values":["A young Caucasian woman with fair skin and light blonde hair. She is wearing a black mesh halter top with a large, shiny red heart decoration sewn onto the most prominent part of the chest. The neckline and cuffs are trimmed with a matching red border. On her lower body, she is wearing high-waisted, form-fitting black shorts and sheer black pantyhose, with slits visible on the sides of her thighs. She is dancing in a room."],"color":"#323","bgcolor":"#535"},{"id":1,"type":"GetNode","pos":[5057.77294921875,1599.626953125],"size":[210,58],"flags":{},"order":28,"mode":0,"inputs":[],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[194]}],"title":"Get_Ref1","properties":{"widget_ue_connectable":{}},"widgets_values":["Ref1"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":38,"type":"GetNode","pos":[5058.56640625,1746.197998046875],"size":[210,58],"flags":{},"order":29,"mode":0,"inputs":[],"outputs":[{"label":"IMAGE","name":"IMAGE","type":"IMAGE","links":[]}],"title":"Get_Ref2","properties":{"widget_ue_connectable":{}},"widgets_values":["Ref2"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":158,"type":"Fast Groups Bypasser (rgthree)","pos":[3922.7255859375,145.37741088867188],"size":[328.0323181152344,275.4235534667969],"flags":{},"order":30,"mode":0,"inputs":[],"outputs":[{"label":"ÂèØÈÄâËøûÊé•","name":"OPT_CONNECTION","type":"*","links":null}],"properties":{"matchColors":"","matchTitle":"","showNav":true,"sort":"position","customSortAlphabet":"","toggleRestriction":"default","widget_ue_connectable":{}}},{"id":129,"type":"LayerMask: PersonMaskUltra V2","pos":[1693.743408203125,2213.38818359375],"size":[270,414],"flags":{},"order":40,"mode":0,"inputs":[{"label":"ÂõæÂÉè","name":"images","type":"IMAGE","link":152}],"outputs":[{"label":"ÂõæÂÉè","name":"image","type":"IMAGE","links":[]},{"label":"ÈÅÆÁΩ©","name":"mask","type":"MASK","links":[153]}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"LayerMask: PersonMaskUltra V2"},"widgets_values":[true,true,true,true,true,false,0.4,"VITMatte",6,6,0.01,0.99,true,"cuda",2],"color":"rgba(27, 80, 119, 0.7)"},{"id":159,"type":"LoadImage","pos":[3022.802978515625,2208.54443359375],"size":[329.1049499511719,562.2514038085938],"flags":{},"order":31,"mode":4,"inputs":[],"outputs":[{"label":"ÂõæÂÉè","name":"IMAGE","type":"IMAGE","links":[195]},{"label":"ÈÅÆÁΩ©","name":"MASK","type":"MASK","links":null}],"properties":{"widget_ue_connectable":{},"Node name for S&R":"LoadImage"},"widgets_values":["keep_this_dic","image"]},{"id":155,"type":"Note","pos":[2791.62109375,2288.113037109375],"size":[210,95.57240295410156],"flags":{},"order":32,"mode":4,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Use this group when you only want to replace the face. Be sure to upload a close-up portrait photo."],"color":"#432","bgcolor":"#653"},{"id":160,"type":"Note","pos":[5058.3134765625,1885.130615234375],"size":[210,88],"flags":{},"order":33,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Connect the line to ref1 when you only want to replace the face"],"color":"#432","bgcolor":"#653"}],"links":[[10,11,0,10,1,"WANVIDIMAGE_EMBEDS"],[11,47,0,10,2,"WANVIDEOTEXTEMBEDS"],[12,14,0,11,0,"WANVAE"],[13,8,0,11,1,"IMAGE"],[14,2,0,11,2,"MASK"],[17,15,0,16,1,"BLOCKSWAPARGS"],[18,46,0,16,2,"WANVIDLORA"],[19,22,0,17,0,"*"],[21,23,0,20,0,"*"],[23,43,0,22,0,"IMAGE"],[24,13,0,23,0,"IMAGE"],[46,42,0,41,0,"IMAGE"],[49,14,0,42,0,"WANVAE"],[50,10,0,42,1,"LATENT"],[52,43,3,44,0,"VHS_VIDEOINFO"],[53,22,0,45,0,"IMAGE"],[55,16,0,48,0,"*"],[117,98,0,100,0,"*"],[118,101,0,22,2,"INT"],[119,45,0,102,0,"*"],[120,22,3,103,0,"*"],[121,22,4,104,0,"*"],[122,105,0,23,2,"INT"],[123,106,0,23,3,"INT"],[128,29,0,108,0,"*"],[129,109,0,47,1,"STRING"],[130,111,0,10,0,"WANVIDEOMODEL"],[132,44,5,113,0,"*"],[133,114,0,41,4,"FLOAT"],[134,43,2,116,0,"*"],[135,117,0,41,1,"AUDIO"],[143,22,0,120,0,"IMAGE"],[150,42,0,128,0,"*"],[152,112,0,129,0,"IMAGE"],[153,129,1,7,0,"MASK"],[162,7,0,3,0,"MASK"],[163,7,0,6,0,"MASK"],[164,23,0,138,0,"IMAGE"],[165,138,0,107,0,"IMAGE"],[168,112,0,140,0,"IMAGE"],[173,142,0,147,2,"INT"],[174,145,0,147,3,"INT"],[182,151,0,150,0,"RETINAFACE"],[184,150,0,143,0,"IMAGE"],[185,143,0,147,0,"IMAGE"],[186,147,0,144,0,"IMAGE"],[187,147,0,146,0,"IMAGE"],[188,114,0,153,2,"FLOAT"],[189,117,0,153,1,"AUDIO"],[190,42,0,153,0,"IMAGE"],[191,153,0,154,0,"IMAGE"],[194,1,0,11,3,"IMAGE"],[195,159,0,150,1,"IMAGE"]],"groups":[{"id":2,"title":"Ref image1","bounding":[2743.4033203125,780.5469970703125,1718.078857421875,821.7159423828125],"color":"#3f789e","font_size":24,"flags":{}},{"id":4,"title":"Mask preprocessing","bounding":[1082.328857421875,2131.758056640625,1415.780517578125,884.774169921875],"color":"#3f789e","font_size":24,"flags":{}},{"id":11,"title":"Basic Settings","bounding":[1087.1124267578125,6.56863260269165,1260.9481201171875,538.3692626953125],"color":"#3f789e","font_size":24,"flags":{}},{"id":12,"title":"Video preprocessing","bounding":[1088.910400390625,735.4441528320312,1054.403076171875,1112.1669921875],"color":"#3f789e","font_size":24,"flags":{}},{"id":13,"title":"Sampling","bounding":[5028.09912109375,771.5494384765625,1940.923828125,1813.54443359375],"color":"#3f789e","font_size":24,"flags":{}},{"id":14,"title":"Ref face image","bounding":[2779.6982421875,2134.9443359375,1733.875,821.7159423828125],"color":"#3f789e","font_size":24,"flags":{}},{"id":15,"title":"Settings items","bounding":[2724.575439453125,3.134918451309204,857.1944580078125,419.6832580566406],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"0246.VERSION":[0,0,4],"ue_links":[],"links_added_by_ue":[],"ds":{"scale":0.1515678918970379,"offset":[487.1114978097512,512.4312995672226]},"frontendVersion":"1.23.0","VHS_latentpreview":false,"VHS_latentpreviewrate":0,"VHS_MetadataImage":true,"VHS_KeepIntermediate":true},"version":0.4}